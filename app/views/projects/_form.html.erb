<div hidden>
  <%= text_area_tag :output, @output %>
</div>

<div id="top-row" class="lgray flex-row h-form-row flex-align-center">
  <div class="flex-col-md-2 flex-col-sm-4">
    <%= form_for project, remote: true, html: {id: 'project-title-form'} do |f| %>
      <%= f.text_field :title, placeholder: 'Title', class: 'form-control' %>
    <% end %>
  </div>

  <div class="flex-col-md-5 flex-col-md-nogrow flex-col-sm-grow flex-col-sm-6">
    <select class="flex-col-xs-12" id="service-selector">
      <!--THE VALUE OF THESE OPTIONS MUST MATCH THE ASSOCIATED CONFIG FILE NAME IN /PUBLIC/CONFIG/-->
      <option value="smack-options">Smack</option>
      <option value="boogie-options">Boogie</option>
    </select>
  </div>
  <div class="flex-col-md-1">
    <button class="btn btn-primary tool-select-button">?</button>
  </div>
</div>

<div class="main-container flex-row">
    <!-- Sidebar -->
    <div id="sidebar" class="flex-col-sm-4 flex-col-md-2 gray">
      <!-- Files -->
      <div id="upload-project-container">
        <div class="field white-color">
          <%= label_tag :input_upload, "Upload Project" %>
          <%= file_field_tag :input_upload, accept: ".zip, application/zip",
                             class: 'white-color' %>
          <span id="input_upload_status"></span>
        </div>
      </div>

      <div id="file-list">
      </div>

    </div>

    <!-- Main -->
    <div class="flex-col-sm-8 flex-col-md-10">

      <!-- Middle -->
      <div id="editors-row" class="flex-row flex-wrap flex-align-stretch lgray">

        <!-- Left -->
        <div class="editor-container flex-col-sm-12 flex-col-md-6">
          <div id="editor1">
          </div>
        </div>

        <!-- Right -->
        <div class="editor-container flex-col-sm-12 flex-col-md-6">
          <div id="editor2">
          </div>
        </div>
      </div>

      <!-- Bottom -->
      <div id="options-and-run-row" class="lgray flex-row h-form-row flex-align-center">
        <div class="flex-col-md-1">
          <%= form_for(project, remote: true, format: :json,
                       html: {id: "run-project-form"}) do |f| %>
            <!--Placeholder for options menu-->
            <div class="btn-group" id="optionsMenu">
              <button data-toggle="dropdown" class="btn dropdown-toggle">Options <span class="caret"></span></button>
            </div>
            <div hidden>
              <%= f.text_field :input, value: @base64_input%>
            </div>
          <% end %>
        </div>
        <div class="flex-col-md-1">
          <button id="run_project" class="btn btn-default btn-primary">Run</button>
        </div>
      </div>
    </div>
</div>

</div>

<!-- End page body -->
<script src="/assets/ace/ace.js" type="text/javascript" charset="utf-8"></script>

<%
  splitOptionsString = [];
  if !@project[:service_options].nil?
    splitOptionsString = @project[:service_options].split()
  end

  # Generate hidden options menu for each config file that will be pulled into
  # the shown options menu when the service type is changed.
  require 'json'
  option_config_files = %w[smack-options.json boogie-options.json]
  option_config_files.each do |file|
    json = File.read('public/config/' + file)
    json = JSON.parse(json)
    id = 1%>
      <div class='hidden' id='<%=file[0..file.index('.json')-1]%>'>
        <button data-toggle="dropdown" class="btn dropdown-toggle"
                data-placeholder='false'>Options <span class="caret"></span></button>
        <ul class="dropdown-menu scrollable-menu pull-top noclose" role="menu">

          <h6 class="dropdown-header">Integer Options</h6>
          <%json['Integer Options'].each do |option|
              index = splitOptionsString.find_index('--'+option['name'])
              if index.nil?
                value = option['default']
              else
                value = splitOptionsString[index + 1]
              end
          %>
              <li><label><%=option['name']%>
                <input type="number" name="<%=option['name']%>" value="<%=value%>" min="<%=option['min']%>"
                       max="<%=option['max']%>" step="1"/></label></li>
            <%id+=1
            end%>

          <h6 class="dropdown-header">String Options</h6>
          <%json['String Options'].each do |option|
              index = splitOptionsString.find_index('--'+option['name'])
              if index.nil?
                value = option['default']
              else
                value = splitOptionsString[index + 1]
              end
          %>
              <li><label><%=option['name']%>
                <input type="text" name="<%=option['name']%>" value="<%=value%>"/></label></li>
          <%id+=1
            end%>

          <h6 class="dropdown-header">Boolean Options</h6>
          <%json['Boolean Options'].each do |option|
              index = splitOptionsString.find_index('--'+option['name'])
              if index.nil?
                checked = ''
              else
                checked = 'checked'
              end
          %>
              <li>
                <input name='<%=option['name']%>' <%=checked%> type='checkbox' id='<%=id%>'/>
                <label for='<%=id%>' ><%=option['name']%></label>
              </li>
          <%
              id+=1
            end
          %>

          <%json['Group Options'].each do |group|
              index = splitOptionsString.find_index('--'+group['name'])
              if !index.nil?
                value = splitOptionsString[index + 1]
              end
          %>
              <h1 class="dropdown-header"><%=group['name']%></h1>
              <%group['options'].each do |option|
                  if (index.nil? and option['default']) or (!index.nil? and option['name'] == value)%>
                        <li><input type="radio" id="<%=id%>" name="<%=group['name']%>" value="<%=option['name']%>" checked >
                          <label for="<%=id%>"><%=option['name']%></label></li>
                    <%else%>
                        <li><input type="radio" id="<%=id%>" name="<%=group['name']%>" value="<%=option['name']%>">
                          <label for="<%=id%>"><%=option['name']%></label></li>
                  <%
                  end
                  id += 1
              end%>
          <%end%>
        </ul>
      </div>
<%end%>
